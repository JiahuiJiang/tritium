machine:
  java:
    version: oraclejdk8
  environment:
    TERM: dumb
  post:
    # Install Unlimited Strength JCE jars for exartisi
    - wget -qO- https://artifactory.palantir.build/artifactory/internal-dist-thirdparty/oracle/jce_policy/8/jce_policy-8.zip | bsdtar -xvf- -C /tmp && sudo cp /tmp/UnlimitedJCEPolicyJDK8/* $JAVA_HOME/jre/lib/security/

checkout:
  post:
    - git tag --list | xargs git tag --delete
    - git fetch --tags
    - git describe --tags

dependencies:
  override:
    - ./gradlew assemble compileTestJava --console=plain --stacktrace

test:
  override:
    - ./scripts/verify.sh

deployment:
  snapshots:
    branch: develop
    owner: elements
    commands:
      - ./gradlew publish exartisi --console=plain --stacktrace
  releases:
    tag: /[0-9]+(\.[0-9]+)+(-[a-zA-Z]+[0-9]*)*/
    owner: elements
    commands:
      - ./gradlew publish exartisi --console=plain --stacktrace
